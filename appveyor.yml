version: 0.4.0.{build}
skip_tags: true
image: Visual Studio 2017
clone_depth: 1
environment:
  NUGET_SECURE_TOKEN:
    secure: eF0Mu+Ky+FtngFJN7u4unv9l2ebEvlvfim9hPpWkRAc=
  nuget_user: adimosh@gmail.com
  nuget_password:
    secure: QzxGG+tm1H9IaA5tMZx2pA==
install:
- cmd: >-
    appveyor DownloadFile https://dist.nuget.org/win-x86-commandline/v4.1.0/nuget.exe

    nuget sources add -Name MyAccountFeed -Source https://ci.appveyor.com/nuget/adimosh-at-live-dot-com -UserName %nuget_user% -Password %nuget_password%

    nuget restore
build_script:
- cmd: >-
    cd IX.Observable

    dotnet csprojVersioning IX.Observable.csproj %APPVEYOR_BUILD_VERSION%

    dotnet build IX.Observable.csproj -c Release

    cd..
test_script:
- cmd: >-
    cd IX.Observable.UnitTests

    dotnet xunit

    cd ..
deploy_script:
- cmd: >-
    dotnet pack IX.Observable\IX.Observable.csproj -c Release --no-build

    nuget push IX.Observable\bin\Release\IX.Observable.%APPVEYOR_BUILD_VERSION%.nupkg -ApiKey %NUGET_SECURE_TOKEN% -Source https://ci.appveyor.com/nuget/adimosh-at-live-dot-com/api/v2/package